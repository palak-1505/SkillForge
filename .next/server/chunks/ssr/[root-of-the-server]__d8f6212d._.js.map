{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/harshitgangwar/Desktop/SkillForge/actions/interview.js"],"sourcesContent":["\"use server\";\n\nimport { db } from \"@/lib/prisma\";\nimport { auth } from \"@clerk/nextjs/server\";\nimport { GoogleGenAI } from \"@google/genai\";\n\nconst genAI = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY });\n\n// --- ðŸ› ï¸ JSON Schema for Structured Output ---\n// This schema strictly defines the expected structure of the quiz response,\n// forcing the model to return valid, predictable JSON.\nconst quizSchema = {\n  type: \"object\",\n  properties: {\n    questions: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        properties: {\n          question: { type: \"string\" },\n          options: {\n            type: \"array\",\n            items: { type: \"string\" },\n            minItems: 4,\n            maxItems: 4,\n          },\n          correctAnswer: { type: \"string\" },\n          explanation: { type: \"string\" },\n        },\n        required: [\n          \"question\",\n          \"options\",\n          \"correctAnswer\",\n          \"explanation\",\n        ],\n      },\n      minItems: 10,\n      maxItems: 10,\n    },\n  },\n  required: [\"questions\"],\n};\n\n// ====================================================================\n// GENERATE QUIZ FUNCTION (IMPROVED WITH STRUCTURED OUTPUT)\n// ====================================================================\n// ====================================================================\n// GENERATE QUIZ FUNCTION (IMPROVED WITH STRUCTURED OUTPUT)\n// ====================================================================\nexport async function generateQuiz() {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  const user = await db.user.findUnique({\n    where: { clerkUserId: userId },\n    select: { industry: true, skills: true },\n  });\n\n  if (!user) throw new Error(\"User not found\");\n\n  // 1. ðŸš€ UPDATED PROMPT FOR EASIER, USER-FRIENDLY, AND TRENDY QUESTIONS\n  const prompt = `\n    Generate exactly 10 engaging and easy-to-understand multiple-choice quiz questions\n    for a ${user.industry} professional${\n      user.skills?.length ? ` with knowledge in ${user.skills.join(\", \")}` : \"\"\n    }.\n    \n    The questions should focus on **current industry trends, popular tools, fundamental concepts, and general knowledge**\n    relevant to the user's profile to create a fun, user-friendly, and trendy quiz.\n    \n    Each question must be multiple choice with 4 distinct options, a single correct answer, and a concise explanation.\n  `;\n\n  try {\n    const result = await genAI.models.generateContent({\n      // Use a model that supports structured output (e.g., gemini-2.5-flash or gemini-1.5-flash)\n      model: \"gemini-2.5-flash\",\n      contents: [{ role: \"user\", parts: [{ text: prompt }] }],\n      config: {\n        // Enforce JSON output conforming to the schema\n        responseMimeType: \"application/json\",\n        responseSchema: quizSchema,\n      },\n    });\n\n    // The .text accessor is the correct way to get the response string.\n    // It is guaranteed to be valid JSON by the model configuration.\n    const text = result.text.trim();\n\n    if (!text) {\n      console.error(\"Gemini returned empty response:\", result);\n      throw new Error(\"Empty response from Gemini\");\n    }\n\n    let quiz;\n    try {\n      // Directly parse the JSON string\n      quiz = JSON.parse(text);\n    } catch (err) {\n      // Fallback in case of parsing error, though rare with structured output\n      console.error(\"Failed to parse guaranteed JSON:\", text, err);\n      throw new Error(\"AI returned an unparsable structure\");\n    }\n\n    if (!quiz?.questions || !Array.isArray(quiz.questions) || quiz.questions.length !== 10) {\n      throw new Error(\"Invalid quiz structure or question count returned by AI\");\n    }\n\n    return quiz.questions;\n  } catch (error) {\n    console.error(\"âŒ Error generating quiz:\", error.message);\n    // console.error(error.stack); // Uncomment for full stack trace in dev\n    throw new Error(\"Failed to generate quiz questions. Please try again.\");\n  }\n}\n\n// ====================================================================\n// SAVE QUIZ RESULT FUNCTION\n// ====================================================================\nexport async function saveQuizResult(questions, answers, score) {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  const user = await db.user.findUnique({\n    where: { clerkUserId: userId },\n  });\n\n  if (!user) throw new Error(\"User not found\");\n\n  const questionResults = questions.map((q, index) => ({\n    question: q.question,\n    answer: q.correctAnswer,\n    userAnswer: answers[index],\n    isCorrect: q.correctAnswer === answers[index],\n    explanation: q.explanation,\n  }));\n\n  const wrongAnswers = questionResults.filter((q) => !q.isCorrect);\n\n  let improvementTip = null;\n  if (wrongAnswers.length > 0) {\n    const wrongQuestionsText = wrongAnswers\n      .map(\n        (q) =>\n          `Question: \"${q.question}\"\\nCorrect Answer: \"${q.answer}\"\\nUser Answer: \"${q.userAnswer}\"`\n      )\n      .join(\"\\n\\n\");\n\n    const improvementPrompt = `\n      The user is a ${user.industry} professional. They got the following technical interview questions wrong:\n\n      ${wrongQuestionsText}\n\n      Based on these mistakes, provide a concise, specific improvement tip.\n      Focus on the knowledge gaps revealed by these wrong answers (e.g., \"Review asynchronous programming concepts...\" or \"Practice object-oriented design patterns...\").\n      Keep the response under 2 sentences and make it encouraging.\n      Do not explicitly mention the mistakes or the number of incorrect answers.\n    `;\n\n    try {\n      const tipResult = await genAI.models.generateContent({\n        model: \"gemini-2.0-flash\", // Using 2.0-flash for speed/cost on simple text gen\n        contents: [{ role: \"user\", parts: [{ text: improvementPrompt }] }],\n      });\n\n      improvementTip = tipResult.text.trim();\n    } catch (error) {\n      console.error(\"Error generating improvement tip:\", error);\n      improvementTip = \"Keep practicing! Reviewing the concepts from your incorrect answers is a great next step.\";\n    }\n  }\n\n  try {\n    const assessment = await db.assessment.create({\n      data: {\n        userId: user.id,\n        quizScore: score,\n        questions: questionResults,\n        category: \"Technical\",\n        improvementTip,\n      },\n    });\n\n    return assessment;\n  } catch (error) {\n    console.error(\"Error saving quiz result:\", error);\n    throw new Error(\"Failed to save quiz result\");\n  }\n}\n\n// ====================================================================\n// GET ASSESSMENTS FUNCTION\n// ====================================================================\nexport async function getAssessments() {\n  const { userId } = await auth();\n  if (!userId) throw new Error(\"Unauthorized\");\n\n  const user = await db.user.findUnique({\n    where: { clerkUserId: userId },\n  });\n\n  if (!user) throw new Error(\"User not found\");\n\n  try {\n    const assessments = await db.assessment.findMany({\n      where: { userId: user.id },\n      orderBy: { createdAt: \"desc\" }, // Changed to 'desc' to show latest first\n    });\n\n    return assessments;\n  } catch (error) {\n    console.error(\"Error fetching assessments:\", error);\n    throw new Error(\"Failed to fetch assessments\");\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 394, "column": 0}, "map": {"version":3,"sources":["file:///Users/harshitgangwar/Desktop/SkillForge/app/%28main%29/interview/_components/quiz.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(main)/interview/_components/quiz.jsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(main)/interview/_components/quiz.jsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA6S,GAC1U,2EACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 408, "column": 0}, "map": {"version":3,"sources":["file:///Users/harshitgangwar/Desktop/SkillForge/app/%28main%29/interview/_components/quiz.jsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(main)/interview/_components/quiz.jsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(main)/interview/_components/quiz.jsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAyR,GACtT,uDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 422, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 430, "column": 0}, "map": {"version":3,"sources":["file:///Users/harshitgangwar/Desktop/SkillForge/app/%28main%29/interview/mock/page.jsx"],"sourcesContent":["import Link from \"next/link\";\nimport { ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport Quiz from \"../_components/quiz\";\n\nexport default function MockInterviewPage() {\n  return (\n    <div className=\"container mx-auto space-y-4 py-6\">\n      <div className=\"flex flex-col space-y-2 mx-2\">\n        <Link href=\"/interview\">\n          <Button variant=\"link\" className=\"gap-2 pl-0\">\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back to Interview Preparation\n          </Button>\n        </Link>\n\n        <div>\n          <h1 className=\"text-6xl font-bold gradient-title\">Mock Interview</h1>\n          <p className=\"text-muted-foreground\">\n            Test your knowledge with industry-specific questions\n          </p>\n        </div>\n      </div>\n\n      <Quiz />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEe,SAAS;IACtB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,uKAAI;wBAAC,MAAK;kCACT,cAAA,8OAAC,qIAAM;4BAAC,SAAQ;4BAAO,WAAU;;8CAC/B,8OAAC,6NAAS;oCAAC,WAAU;;;;;;gCAAY;;;;;;;;;;;;kCAKrC,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAAoC;;;;;;0CAClD,8OAAC;gCAAE,WAAU;0CAAwB;;;;;;;;;;;;;;;;;;0BAMzC,8OAAC,+JAAI;;;;;;;;;;;AAGX","debugId":null}}]
}